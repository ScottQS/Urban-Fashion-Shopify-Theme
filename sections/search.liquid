<section class="section-shell search-page">
  <h1>Search</h1>

  <form class="search-page__form" action="{{ routes.search_url }}" method="get" role="search">
    <label class="visually-hidden" for="SearchInTemplate">Search store</label>
    <input
      id="SearchInTemplate"
      type="search"
      name="q"
      value="{{ search.terms | escape }}"
      placeholder="Search products, pages, and blog posts"
    >
    <input type="hidden" name="type" value="product,page,article">
    <input type="hidden" name="options[prefix]" value="last">
    <button class="button button--primary" type="submit">Search</button>
  </form>

  {% if search.performed %}
    <p>{{ search.results_count }} results for “{{ search.terms | escape }}”</p>

    {% paginate search.results by 24 %}
      <div class="search-page__layout">
        {% if search.filters != blank %}
          <aside class="search-page__filters">
            <h2>Filter</h2>
            <form method="get">
              <input type="hidden" name="q" value="{{ search.terms | escape }}">
              <input type="hidden" name="type" value="product,page,article">

              {% for filter in search.filters %}
                <details class="search-page__filter-group" open>
                  <summary>{{ filter.label }}</summary>

                  {% case filter.type %}
                    {% when 'list', 'boolean' %}
                      <ul role="list" class="search-page__filter-list">
                        {% for value in filter.values %}
                          <li>
                            <label>
                              <input
                                type="checkbox"
                                name="{{ value.param_name }}"
                                value="{{ value.value }}"
                                {% if value.active %}
                                  checked
                                {% endif %}
                                {% if value.count == 0 and value.active == false %}
                                  disabled
                                {% endif %}
                              >
                              {{ value.label }} ({{ value.count }})
                            </label>
                          </li>
                        {% endfor %}
                      </ul>
                    {% when 'price_range' %}
                      <div class="search-page__price-range">
                        <label for="SearchFilter-{{ filter.min_value.param_name }}">From</label>
                        <input
                          id="SearchFilter-{{ filter.min_value.param_name }}"
                          name="{{ filter.min_value.param_name }}"
                          type="number"
                          min="0"
                          placeholder="0"
                          {% if filter.min_value.value %}
                            value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"
                          {% endif %}
                        >
                        <label for="SearchFilter-{{ filter.max_value.param_name }}">To</label>
                        <input
                          id="SearchFilter-{{ filter.max_value.param_name }}"
                          name="{{ filter.max_value.param_name }}"
                          type="number"
                          min="0"
                          placeholder="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                          {% if filter.max_value.value %}
                            value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"
                          {% endif %}
                        >
                      </div>
                  {% endcase %}
                </details>
              {% endfor %}

              <button class="button button--primary" type="submit">Apply filters</button>
              <a class="button button--secondary" href="{{ routes.search_url }}?q={{ search.terms | escape }}&type=product,page,article">
                Clear filters
              </a>
            </form>
          </aside>
        {% endif %}

        <div>
          {% if search.results_count == 0 %}
            <div class="empty-state">
              <p>No results found. Try a different search term.</p>
            </div>
          {% else %}
            <div class="search-page__results">
              {% for result in search.results %}
                <article class="card search-result">
                  {% assign featured_image = result.featured_image | default: result.image %}
                  {% if featured_image %}
                    {% render
                      'image',
                      class: 'search-result__image',
                      image: featured_image,
                      url: result.url,
                      width: 900,
                      sizes: '(min-width: 990px) 25vw, (min-width: 750px) 33vw, 50vw'
                    %}
                  {% endif %}

                  <div class="card__content">
                    <span class="badge">{{ result.object_type | capitalize }}</span>
                    <h2><a href="{{ result.url }}">{{ result.title }}</a></h2>

                    {% if result.object_type == 'product' %}
                      {% render 'price', variant: result.selected_or_first_available_variant, show_unit_price: true %}
                    {% endif %}

                    {% if result.object_type == 'article' %}
                      <p>{{ result.excerpt_or_content | strip_html | truncatewords: 20 }}</p>
                    {% endif %}
                  </div>
                </article>
              {% endfor %}
            </div>
          {% endif %}

          {% if paginate.pages > 1 %}
            <nav class="pagination" role="navigation" aria-label="Pagination">
              {{ paginate | default_pagination }}
            </nav>
          {% endif %}
        </div>
      </div>
    {% endpaginate %}
  {% endif %}
</section>

{% stylesheet %}
  .search-page__form {
    display: flex;
    gap: 0.6rem;
    margin: 1rem 0 1.25rem;
    flex-wrap: wrap;
  }

  .search-page__form input {
    flex: 1 1 16rem;
  }

  .search-page__layout {
    display: grid;
    grid-template-columns: minmax(15rem, 18rem) minmax(0, 1fr);
    gap: 1.3rem;
  }

  .search-page__filters {
    position: sticky;
    top: 1rem;
    align-self: start;
    border: 1px solid var(--color-border);
    border-radius: 1rem;
    background-color: var(--color-surface);
    padding: 1rem;
    display: grid;
    gap: 0.7rem;
  }

  .search-page__filter-group {
    border-top: 1px solid var(--color-border);
    padding-top: 0.6rem;
  }

  .search-page__filter-list {
    list-style: none;
    margin: 0.45rem 0 0;
    padding: 0;
    display: grid;
    gap: 0.35rem;
  }

  .search-page__price-range {
    display: grid;
    gap: 0.35rem;
    margin-top: 0.45rem;
  }

  .search-page__results {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 1rem;
  }

  @media (max-width: 999px) {
    .search-page__results {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  @media (max-width: 899px) {
    .search-page__layout {
      grid-template-columns: 1fr;
    }

    .search-page__filters {
      position: static;
    }
  }

  @media (max-width: 560px) {
    .search-page__results {
      grid-template-columns: 1fr;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Main search",
  "settings": []
}
{% endschema %}
