<section class="section-shell cart-page">
  <h1>Cart</h1>

  {% if cart.item_count == 0 %}
    <div class="empty-state">
      <p>Your cart is empty.</p>
      <a class="button button--primary" href="{{ routes.all_products_collection_url }}">Continue shopping</a>
    </div>
  {% else %}
    <form action="{{ routes.cart_url }}" method="post" novalidate>
      <div class="cart-page__layout">
        <div class="cart-page__items">
          {% for item in cart.items %}
            <article class="cart-page__item card">
              <div class="cart-page__item-media">
                {% if item.image %}
                  {% render 'image', image: item.image, url: item.url, width: 600, class: 'cart-page__item-image' %}
                {% endif %}
              </div>
              <div class="cart-page__item-content">
                <h2><a href="{{ item.url }}">{{ item.product.title }}</a></h2>
                {% unless item.variant.title contains 'Default' %}
                  <p>{{ item.variant.title }}</p>
                {% endunless %}

                {% if item.options_with_values.size > 0 %}
                  <ul class="cart-page__options" role="list">
                    {% for option in item.options_with_values %}
                      <li>{{ option.name }}: {{ option.value }}</li>
                    {% endfor %}
                  </ul>
                {% endif %}

                {% if item.selling_plan_allocation %}
                  <p>Selling plan: {{ item.selling_plan_allocation.selling_plan.name }}</p>
                {% endif %}

                <div>
                  <p class="price">{{ item.final_price | money }}</p>
                  {% if item.unit_price_measurement %}
                    <p class="price--unit">
                      {{ item.unit_price | money }}
                      /
                      {% if item.unit_price_measurement.reference_value != 1 %}
                        {{ item.unit_price_measurement.reference_value }}
                      {% endif %}
                      {{ item.unit_price_measurement.reference_unit }}
                    </p>
                  {% endif %}
                </div>

                {% if item.line_level_discount_allocations.size > 0 %}
                  <ul class="cart-page__discounts" role="list">
                    {% for discount_allocation in item.line_level_discount_allocations %}
                      <li>
                        {{ discount_allocation.discount_application.title }} (-{{ discount_allocation.amount | money }})
                      </li>
                    {% endfor %}
                  </ul>
                {% endif %}

                <div class="cart-page__item-actions">
                  <label for="CartQuantity-{{ item.index | plus: 1 }}">Quantity</label>
                  <input
                    id="CartQuantity-{{ item.index | plus: 1 }}"
                    type="number"
                    name="updates[{{ item.key }}]"
                    min="0"
                    value="{{ item.quantity }}"
                  >
                  <a href="{{ item.url_to_remove }}" aria-label="Remove {{ item.product.title }}">Remove</a>
                </div>
              </div>
            </article>
          {% endfor %}

          <button class="button button--secondary" type="submit" name="update">Update cart</button>
        </div>

        <aside class="cart-page__summary card">
          <h2>Order summary</h2>

          {% if cart.cart_level_discount_applications.size > 0 %}
            <ul class="cart-page__discounts" role="list">
              {% for discount_application in cart.cart_level_discount_applications %}
                <li>{{ discount_application.title }} (-{{ discount_application.total_allocated_amount | money }})</li>
              {% endfor %}
            </ul>
          {% endif %}

          <p class="cart-page__subtotal">
            Subtotal
            <strong>{{ cart.total_price | money }}</strong>
          </p>

          <p class="cart-page__tax-note">
            {% if cart.taxes_included %}
              Taxes included.
            {% else %}
              Taxes and shipping calculated at checkout.
            {% endif %}
          </p>

          <label for="CartNote">Cart note</label>
          <textarea id="CartNote" name="note">{{ cart.note }}</textarea>

          <button class="button button--primary" type="submit" name="checkout">Checkout</button>
          {% if additional_checkout_buttons %}
            <div class="cart-page__accelerated-checkout">
              {{ content_for_additional_checkout_buttons }}
            </div>
          {% endif %}
        </aside>
      </div>
    </form>
  {% endif %}
</section>

{% stylesheet %}
  .cart-page__layout {
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(18rem, 24rem);
    gap: 1.2rem;
    align-items: start;
  }

  .cart-page__items {
    display: grid;
    gap: 0.75rem;
  }

  .cart-page__item {
    display: grid;
    grid-template-columns: minmax(6.5rem, 8rem) minmax(0, 1fr);
    gap: 0.8rem;
  }

  .cart-page__item-media {
    border-right: 1px solid var(--color-border);
  }

  .cart-page__item-content {
    padding: 0.9rem;
    display: grid;
    gap: 0.5rem;
  }

  .cart-page__options,
  .cart-page__discounts {
    margin: 0;
    padding-left: 1rem;
  }

  .cart-page__item-actions {
    display: inline-flex;
    gap: 0.5rem;
    align-items: center;
    flex-wrap: wrap;
  }

  .cart-page__item-actions input {
    width: 5rem;
  }

  .cart-page__summary {
    padding: 1rem;
    display: grid;
    gap: 0.75rem;
    position: sticky;
    top: 1rem;
  }

  .cart-page__subtotal {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: 0.5rem;
  }

  .cart-page__tax-note {
    font-size: 0.9rem;
    color: color-mix(in srgb, var(--color-foreground), #fff 35%);
  }

  @media (max-width: 899px) {
    .cart-page__layout {
      grid-template-columns: 1fr;
    }

    .cart-page__summary {
      position: static;
    }
  }

  @media (max-width: 520px) {
    .cart-page__item {
      grid-template-columns: 1fr;
    }

    .cart-page__item-media {
      border-right: 0;
      border-bottom: 1px solid var(--color-border);
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Main cart",
  "settings": []
}
{% endschema %}
